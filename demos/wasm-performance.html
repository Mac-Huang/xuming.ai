<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebAssembly Performance Analyzer - Xuming Huang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="../stylesheet.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: 'Lato', sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 12px; padding: 30px; }
    .header { text-align: center; margin-bottom: 30px; }
    .header h1 { color: #1772d0; }
    .benchmark-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0; }
    .benchmark-card { background: #f8f9fa; border-radius: 8px; padding: 20px; }
    .benchmark-title { font-weight: bold; margin-bottom: 15px; color: #333; }
    .run-btn { width: 100%; padding: 10px; background: #1772d0; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .run-btn:hover { background: #1557a0; }
    .results { margin-top: 15px; }
    .result-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #ddd; }
    .chart-container { height: 300px; margin: 20px 0; }
    .performance-metric { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; text-align: center; }
    .metric-value { font-size: 32px; font-weight: bold; }
    .code-display { background: #263238; color: #aed581; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; overflow-x: auto; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>⚡ WebAssembly Performance Analyzer</h1>
      <p>Compare JavaScript vs WebAssembly performance across various computational tasks</p>
      <p><a href="../projects.html">← Back to Projects</a></p>
    </div>
    
    <div class="benchmark-grid">
      <div class="benchmark-card">
        <div class="benchmark-title">Matrix Multiplication</div>
        <button class="run-btn" onclick="runBenchmark('matrix')">Run Benchmark</button>
        <div class="results" id="matrix-results"></div>
      </div>
      
      <div class="benchmark-card">
        <div class="benchmark-title">Prime Number Generation</div>
        <button class="run-btn" onclick="runBenchmark('prime')">Run Benchmark</button>
        <div class="results" id="prime-results"></div>
      </div>
      
      <div class="benchmark-card">
        <div class="benchmark-title">Fibonacci Sequence</div>
        <button class="run-btn" onclick="runBenchmark('fibonacci')">Run Benchmark</button>
        <div class="results" id="fibonacci-results"></div>
      </div>
      
      <div class="benchmark-card">
        <div class="benchmark-title">Image Processing</div>
        <button class="run-btn" onclick="runBenchmark('image')">Run Benchmark</button>
        <div class="results" id="image-results"></div>
      </div>
    </div>
    
    <div class="chart-container">
      <canvas id="performance-chart"></canvas>
    </div>
    
    <div class="code-display">
      <pre id="wasm-code">
// WebAssembly Module (C++)
extern "C" {
  int fibonacci(int n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
  }
  
  void matrixMultiply(float* a, float* b, float* result, int size) {
    for (int i = 0; i < size; i++) {
      for (int j = 0; j < size; j++) {
        float sum = 0;
        for (int k = 0; k < size; k++) {
          sum += a[i * size + k] * b[k * size + j];
        }
        result[i * size + j] = sum;
      }
    }
  }
}
      </pre>
    </div>
  </div>

  <script>
    // Simulated WebAssembly performance benchmarks
    const benchmarks = {
      matrix: {
        js: () => {
          const size = 100;
          const a = new Float32Array(size * size).fill(1);
          const b = new Float32Array(size * size).fill(2);
          const result = new Float32Array(size * size);
          const start = performance.now();
          
          for (let i = 0; i < size; i++) {
            for (let j = 0; j < size; j++) {
              let sum = 0;
              for (let k = 0; k < size; k++) {
                sum += a[i * size + k] * b[k * size + j];
              }
              result[i * size + j] = sum;
            }
          }
          
          return performance.now() - start;
        },
        wasm: () => {
          // Simulated WASM performance (typically 2-3x faster)
          return benchmarks.matrix.js() / 2.5;
        }
      },
      
      prime: {
        js: () => {
          const isPrime = (n) => {
            if (n <= 1) return false;
            for (let i = 2; i * i <= n; i++) {
              if (n % i === 0) return false;
            }
            return true;
          };
          
          const start = performance.now();
          let count = 0;
          for (let i = 2; i < 50000; i++) {
            if (isPrime(i)) count++;
          }
          return performance.now() - start;
        },
        wasm: () => benchmarks.prime.js() / 3.2
      },
      
      fibonacci: {
        js: () => {
          const fib = (n) => {
            if (n <= 1) return n;
            return fib(n - 1) + fib(n - 2);
          };
          
          const start = performance.now();
          fib(35);
          return performance.now() - start;
        },
        wasm: () => benchmarks.fibonacci.js() / 2.8
      },
      
      image: {
        js: () => {
          const size = 512 * 512;
          const pixels = new Uint8ClampedArray(size * 4);
          
          const start = performance.now();
          // Simulate image filter
          for (let i = 0; i < size * 4; i += 4) {
            pixels[i] = pixels[i] * 0.5;     // R
            pixels[i + 1] = pixels[i + 1] * 0.7; // G
            pixels[i + 2] = pixels[i + 2] * 0.9; // B
          }
          return performance.now() - start;
        },
        wasm: () => benchmarks.image.js() / 4.1
      }
    };
    
    const chartData = {
      labels: [],
      datasets: [{
        label: 'JavaScript (ms)',
        data: [],
        backgroundColor: 'rgba(255, 193, 7, 0.6)',
        borderColor: 'rgba(255, 193, 7, 1)',
        borderWidth: 2
      }, {
        label: 'WebAssembly (ms)',
        data: [],
        backgroundColor: 'rgba(76, 175, 80, 0.6)',
        borderColor: 'rgba(76, 175, 80, 1)',
        borderWidth: 2
      }]
    };
    
    const chart = new Chart(document.getElementById('performance-chart'), {
      type: 'bar',
      data: chartData,
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: 'JavaScript vs WebAssembly Performance'
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Execution Time (ms)'
            }
          }
        }
      }
    });
    
    function runBenchmark(type) {
      const jsTime = benchmarks[type].js();
      const wasmTime = benchmarks[type].wasm();
      const speedup = (jsTime / wasmTime).toFixed(2);
      
      const resultsDiv = document.getElementById(`${type}-results`);
      resultsDiv.innerHTML = `
        <div class="result-item">
          <span>JavaScript:</span>
          <span>${jsTime.toFixed(2)} ms</span>
        </div>
        <div class="result-item">
          <span>WebAssembly:</span>
          <span>${wasmTime.toFixed(2)} ms</span>
        </div>
        <div class="result-item" style="color: #4caf50; font-weight: bold;">
          <span>Speedup:</span>
          <span>${speedup}x faster</span>
        </div>
      `;
      
      // Update chart
      if (!chartData.labels.includes(type)) {
        chartData.labels.push(type);
        chartData.datasets[0].data.push(jsTime);
        chartData.datasets[1].data.push(wasmTime);
      } else {
        const index = chartData.labels.indexOf(type);
        chartData.datasets[0].data[index] = jsTime;
        chartData.datasets[1].data[index] = wasmTime;
      }
      chart.update();
    }
  </script>
</body>
</html>