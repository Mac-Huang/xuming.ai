<!DOCTYPE html>
<html>
<head>
  <title>Gemini API Test</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    button { padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
    button:hover { background: #45a049; }
    #result { margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 4px; min-height: 100px; }
    #status { padding: 10px; margin: 10px 0; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .loading { background: #d1ecf1; color: #0c5460; }
  </style>
</head>
<body>
  <h1>Gemini API Connection Test</h1>
  <p>API Key: AIzaSyAllu6kCLJqR9s2EFemZ4wvcwRaoCv6dtA</p>
  
  <div style="margin: 10px 0;">
    <label>Select Model: </label>
    <select onchange="changeEndpoint(this.value)" style="padding: 5px;">
      <option value="gemini-1.5-flash">Gemini 1.5 Flash (Recommended)</option>
      <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
      <option value="gemini-pro">Gemini Pro (Legacy)</option>
    </select>
  </div>
  
  <button onclick="testSimple()">Test Simple Query</button>
  <button onclick="testComplex()">Test Complex Query</button>
  <button onclick="testTechnical()">Test Technical Query</button>
  <button onclick="listModels()" style="background: #2196F3;">List Available Models</button>
  
  <div id="status"></div>
  <div id="result"></div>
  
  <script>
    const API_KEY = 'AIzaSyAllu6kCLJqR9s2EFemZ4wvcwRaoCv6dtA';
    // Try different API endpoints
    const API_ENDPOINTS = {
      'gemini-1.5-flash': `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`,
      'gemini-1.5-pro': `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro-latest:generateContent?key=${API_KEY}`,
      'gemini-pro': `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`
    };
    
    let currentEndpoint = 'gemini-1.5-flash';
    let API_URL = API_ENDPOINTS[currentEndpoint];
    
    async function testAPI(prompt) {
      const statusDiv = document.getElementById('status');
      const resultDiv = document.getElementById('result');
      
      statusDiv.className = 'loading';
      statusDiv.innerHTML = 'Calling Gemini API...';
      resultDiv.innerHTML = '';
      
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            contents: [{
              parts: [{
                text: prompt
              }]
            }],
            generationConfig: {
              temperature: 0.7,
              topK: 40,
              topP: 0.95,
              maxOutputTokens: 200,
            },
            safetySettings: [
              {
                category: "HARM_CATEGORY_HARASSMENT",
                threshold: "BLOCK_NONE"
              },
              {
                category: "HARM_CATEGORY_HATE_SPEECH",
                threshold: "BLOCK_NONE"
              },
              {
                category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                threshold: "BLOCK_NONE"
              },
              {
                category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                threshold: "BLOCK_NONE"
              }
            ]
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('Full response:', data);
        
        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
          const text = data.candidates[0].content.parts[0].text;
          statusDiv.className = 'success';
          statusDiv.innerHTML = '✓ API call successful!';
          resultDiv.innerHTML = '<strong>Response:</strong><br>' + text.replace(/\n/g, '<br>');
        } else {
          throw new Error('Unexpected response format');
        }
      } catch (error) {
        statusDiv.className = 'error';
        statusDiv.innerHTML = '✗ Error: ' + error.message;
        resultDiv.innerHTML = '<strong>Error Details:</strong><br>' + error.toString();
        console.error('API Error:', error);
      }
    }
    
    function testSimple() {
      testAPI('Say hello and tell me the capital of France in one sentence.');
    }
    
    function testComplex() {
      testAPI('You are Xuming Bot. User asks: What is your research focus? Answer as Xuming Huang, a CS student interested in ML systems.');
    }
    
    function testTechnical() {
      testAPI('Explain gradient checkpointing in 2-3 sentences.');
    }
    
    function changeEndpoint(model) {
      currentEndpoint = model;
      API_URL = API_ENDPOINTS[currentEndpoint];
      document.getElementById('status').innerHTML = `Switched to ${model}`;
      document.getElementById('status').className = 'success';
    }
    
    async function listModels() {
      const statusDiv = document.getElementById('status');
      const resultDiv = document.getElementById('result');
      
      statusDiv.className = 'loading';
      statusDiv.innerHTML = 'Fetching available models...';
      
      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${API_KEY}`);
        const data = await response.json();
        
        if (data.models) {
          statusDiv.className = 'success';
          statusDiv.innerHTML = '✓ Models fetched successfully!';
          resultDiv.innerHTML = '<strong>Available Models:</strong><br>' + 
            data.models.map(m => `• ${m.name} - ${m.displayName}`).join('<br>');
        } else {
          throw new Error('No models found');
        }
      } catch (error) {
        statusDiv.className = 'error';
        statusDiv.innerHTML = '✗ Error fetching models: ' + error.message;
      }
    }
  </script>
</body>
</html>